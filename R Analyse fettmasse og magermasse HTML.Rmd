---
title: "Analyse fettmasse1"
author: "Even H Rosenlund"
date: "4/21/2021"
output:
  html_document: default
  pdf_document: default
  word_document: default
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE, echo=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
library(readxl)
library(tidyverse)
library(knitr)
library(broom)
library(tinytex)
library(nlme)
library(lme4)
library(broom)
library(emmeans)
library(ggplot2)
library(cowplot)
library(magick)
library(corrplot)


```

# Analyse fettmase DXA, Gruppe A = <=29.9 KMI, Gruppe B =>30 KMI.

## Gruppevis % endring i android fettmasse fra pre(t2) til post (t4)

```{r, warning = FALSE, echo=FALSE, message=FALSE, include=FALSE}

lineplot.android <- read_excel("data/TR015_DXA_Ferdig.xlsx", sheet = "Android_fettmasse", na = "NA") %>%
   select(subject,bmi,t1,t2,t3,t4, gruppe ) %>%
  filter(!is.na(gruppe)) %>%
  mutate(endring = ((t4 / t2)-1)*100) %>%
  select(subject, bmi, endring, gruppe) %>%
  group_by(gruppe) %>%
  summarise(m = mean(endring, na.rm = TRUE),
            s = sd(endring, na.rm = TRUE )) %>%
ggplot(aes(gruppe, m, fill = gruppe)) +
  geom_errorbar(aes(ymin = m - s, ymax = m + s), width = 0.2) +
  geom_point(size = 4, shape = 21) +
  labs (x = "Grupper, A ≤ 29.9, B ≥ 30", y = "T2 til T4 (mean \U00B1 SD)") +
  theme(legend.position = "none") +
 #scale_y_continuous(limits = c(-5, 20), breaks = c(-5, 0, 5, 10, 15, 20),
                    # expand = expand_scale(0)) +
  theme_bw()

plot(lineplot.android)


#2
 and.fett <- read_excel("data/TR015_DXA_Ferdig.xlsx",sheet = "Android_fettmasse", na = "NA") %>%
  select(subject, bmi, t1, t2, t3, t4, gruppe) %>%
  filter(!is.na(gruppe))%>%
  mutate(endring = ((t4/t2)-1)*100) %>%
  select(subject, bmi, endring, gruppe) %>%
  ggplot(aes(x = bmi, y = endring)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  scale_x_continuous(name = " KMI") +
  scale_y_continuous(name = "% Endring i android fettmasse T2-T4" )
 
 plot(and.fett)
 



 
```

## Gruppevis endring i android fettmasse fra pre til post

```{r}

lineplot.android.ab <- read_excel("data/TR015_DXA_Ferdig.xlsx", 
    sheet = "Android_fettmasse") %>%
   select(subject,bmi,t1,t2,t3,t4, gruppe ) %>%
  filter(!is.na(gruppe)) %>%
  mutate(endring = (t4 -t2)) %>%
  select(subject, bmi, endring, gruppe) %>%
  group_by(gruppe) %>%
  summarise(m = mean(endring, na.rm = TRUE),
            s = sd(endring, na.rm = TRUE )) %>%
ggplot(aes(gruppe, m, fill = gruppe)) +
  geom_errorbar(aes(ymin = m - s, ymax = m + s), width = 0.2) +
  geom_point(size = 4, shape = 21) +
  labs (x = "Grupper, A ≤ 29.9, B ≥ 30", y = "T2 til T4 (mean \U00B1 SD)") +
  theme(legend.position = "none") +
  theme_bw()
  


  
 and.fett.a <- read_excel("data/TR015_DXA_Ferdig.xlsx", 
    sheet = "Android_fettmasse") %>%
  select(subject, bmi, t1, t2, t3, t4, gruppe) %>%
  filter(!is.na(t4))%>%
  mutate(endring = (t4-t2)) %>%
  select(subject, bmi, endring, gruppe) %>%
  ggplot(aes(x = bmi, y = endring)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  scale_x_continuous(name = " KMI") +
  scale_y_continuous(name = "Endring i android fettmasse T2-T4" )

 plot_grid(and.fett.a, lineplot.android.ab)


```

## Gruppevis endring % endring i total fettmasse fra pre(t2) til post (t4)

```{r, warning = FALSE, echo = FALSE }
lineplot.total <-read_excel("data/TR015_DXA_Ferdig.xlsx", sheet = "Hele_fettmasse", na = "NA") %>%
   select("subject...1",bmi,t1,t2,t3,t4, gruppe ) %>%
  filter(!is.na(gruppe)) %>%
  mutate(endring = ((t4 / t2)-1)*100) %>%
  select("subject...1", bmi, endring, gruppe) %>%
  group_by(gruppe) %>%
  summarise(m = mean(endring, na.rm = TRUE),
            s = sd(endring, na.rm = TRUE )) %>%
ggplot(aes(gruppe, m, fill = gruppe)) +
  geom_errorbar(aes(ymin = m - s, ymax = m + s), width = 0.2) +
  geom_point(size = 4, shape = 21) +
  labs (x = "Grupper (A ≤ 29.9, B ≥ 30)",
        y = "T2 til T4 (mean \U00B1 SD)") +
  theme(legend.position = "none") +
  theme_bw()


  tot.fett <- read_excel("data/TR015_DXA_Ferdig.xlsx",sheet = "Hele_fettmasse", na = "NA") %>%
  select("subject...1", bmi, t1, t2, t3, t4, gruppe) %>%
  filter(!is.na(gruppe))%>%
  mutate(endring = ((t4/t2)-1)*100) %>%
  select("subject...1", bmi, endring, gruppe) %>%
  ggplot(aes(x = bmi, y = endring)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  scale_x_continuous(name = "KMI")+
  scale_y_continuous(name ="% Endring i Hele fettmasse T2-T4")

  plot(tot.fett)
  

  
plot_grid(tot.fett, lineplot.total, and.fett, lineplot.android, cols = 2, rows = 2, align = "hv", rel_widths = c(10,9))


plot_grid(and.fett,tot.fett)




```

## Gruppevis endring total fettmasse fra pre til post
```{r}

lineplot.total.a <-read_excel("data/TR015_DXA_Ferdig.xlsx", sheet = "Hele_fettmasse", na = "NA") %>%
   select("subject...1",bmi,t1,t2,t3,t4, gruppe ) %>%
  filter(!is.na(gruppe)) %>%
  mutate(endring = (t4-t2)) %>%
  select("subject...1", bmi, endring, gruppe) %>%
  group_by(gruppe) %>%
  summarise(m = mean(endring, na.rm = TRUE),
            s = sd(endring, na.rm = TRUE )) %>%
ggplot(aes(gruppe, m, fill = gruppe)) +
  geom_errorbar(aes(ymin = m - s, ymax = m + s), width = 0.2) +
  geom_point(size = 4, shape = 21) +
  labs (x = "Grupper (A ≤ 29.9, B ≥ 30)",
        y = "T2 til T4 (mean \U00B1 SD)") +
  theme(legend.position = "none") +
  theme_bw()

tot.fett.a <- read_excel("data/TR015_DXA_Ferdig.xlsx",sheet = "Hele_fettmasse", na = "NA") %>%
  select("subject...1", bmi, t1, t2, t3, t4, gruppe) %>%
  filter(!is.na(gruppe))%>%
  mutate(endring = (t4-t2)) %>%
  select("subject...1", bmi, endring, gruppe) %>%
  ggplot(aes(x = bmi, y = endring)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  scale_x_continuous(name = "KMI")+
  scale_y_continuous(name =" Endring i Hele fettmasse T2-T4")

plot_grid(tot.fett.a, lineplot.total.a, and.fett.a, lineplot.android.ab, cols = 2, rows = 2, align = "hv", rel_widths = c(10,9))

```


# Analyse - Viceralt fettvev MR-bilder, Gruppe A < 30 KMI, Gruppe B > 29.9 KMI 

## Absoulutt endring Visceralt fett, MR

```{r,warning = FALSE, echo=FALSE, include=FALSE}


read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(fp, vicseralt_fett_pre, vicseralt_fett_post, gruppe) %>%
  mutate(endring = ( vicseralt_fett_post - vicseralt_fett_pre )) %>%
  select(endring, fp , vicseralt_fett_pre, vicseralt_fett_post, gruppe) %>%
  filter(!is.na(endring)) %>%
  group_by(gruppe) %>%
  summarise(m = mean(endring, na.rm = TRUE),
            s = sd(endring, na.rm = TRUE )) %>%
  ggplot(aes(gruppe, m, fill = gruppe)) +
  geom_errorbar(aes(ymin = m - s, ymax = m + s), width = 0.2) +
  geom_point(size = 4, shape = 21) +
  labs (x = "Grupper, A ≤ 29.9, B ≥ 30",
        y = " Absoulutt endring i Vicseral fettmasse, T2 - T4 (mean \U00B1 SD)") +
  theme(legend.position = "none") +
  theme_bw()


## regresjonsanalyse?

read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(fp, vicseralt_fett_pre, vicseralt_fett_post, gruppe, bmi) %>%
  filter(!is.na(vicseralt_fett_post)) %>%
  mutate(endring = ( vicseralt_fett_post- vicseralt_fett_pre)) %>%
  select(fp, endring, gruppe, bmi) %>%
  ggplot(aes(x=bmi, y=endring))+
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  scale_x_continuous(name = "BMI") +
  scale_y_continuous(name = "Absoulutt endring i Vicseral fettmasse, T2 - T4")



a1 <- read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(vicseralt_fett_pre, vicseralt_fett_post, bmi, sex) %>%
  mutate(endring = ( vicseralt_fett_post - vicseralt_fett_pre)) %>%
  select(bmi, endring, sex) %>%
  filter(!is.na(endring)) %>%
  print()


  
  m1 <- lm(endring ~ bmi, data = a1)

 plot(m1)
  
  
  summary(m1)
  
  #residuala vs fitted forteller oss hvor mykje talla avviker, visst den raude streken ligger på 0 er det best

#Q-q plot forteller om resudialene følger en normalfordeling, ligge på streken e nice

#scale location, kvadrartrot(standarisert resudial), raud strek rett e nice

#resudial vs leverage- forteller hvor mykje eit tall påverkar i ulike retningar. stor leverage påverkar grafen i større grad. utanfor 0,5 må me skjekka om den skal fjernast.

```


## Relativ endring, Visceralt fett, MR

```{r,warning = FALSE, echo=FALSE, include=FALSE}

#plotbar
lineplot.vfett <- read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(fp, bmi, vicseralt_fett_pre, vicseralt_fett_post, gruppe) %>%
  mutate(endring = ((vicseralt_fett_post / vicseralt_fett_pre)-1)*100) %>%
  mutate(absoulutt_endring = vicseralt_fett_post - vicseralt_fett_pre) %>%
  select(fp, bmi, endring, gruppe)%>%
  group_by(gruppe) %>%
  summarise(m = mean(endring, na.rm = TRUE),
           s = sd(endring, na.rm = TRUE )) %>%
ggplot(aes(gruppe, m, fill = gruppe)) +
  geom_errorbar(aes(ymin = m - s, ymax = m + s), width = 0.2) +
  geom_point(size = 4, shape = 21) +
  labs (x = "Grupper, A ≤ 29.9, B ≥ 30",
        y = "T2 - T4 (mean \U00B1 SD)") +
  theme(legend.position = "none") +
  theme_bw()



#regresjonsanalyse?
  
 rel.endring.v <- read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(fp, bmi, vicseralt_fett_pre, vicseralt_fett_post, gruppe) %>%
  filter(!is.na(vicseralt_fett_post)) %>%
  mutate(endring = ((vicseralt_fett_post / vicseralt_fett_pre)-1)*100) %>%
  select(fp, bmi, endring, gruppe)%>%
  ggplot(aes(x=bmi, y = endring)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  scale_x_continuous(name = "KMI") +
  scale_y_continuous(name = "% Endring i Visceralt fettvev T2 - T4")

a2 <- read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(vicseralt_fett_pre, vicseralt_fett_post, bmi, sex) %>%
  mutate(endring = ((( vicseralt_fett_post/vicseralt_fett_pre)-1)*100)) %>%
  select(bmi, endring, sex) %>%
  print()

print(rel.endring.v)


 m2 <- lm(endring ~ bmi, data = a2)

 plot(m2)
  
 summary(m2)




```



## Absoulutt endring Subkutant fett, MR

```{r,warning = FALSE, echo=FALSE, include=FALSE}

read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(fp, subkutant_fett_pre, subkutant_fett_post, gruppe) %>%
  mutate(endring = ( subkutant_fett_post - subkutant_fett_pre )) %>%
  select(endring, fp , subkutant_fett_pre, subkutant_fett_post, gruppe) %>%
  filter(!is.na(endring)) %>%
  group_by(gruppe) %>%
  summarise(m = mean(endring, na.rm = TRUE),
            s = sd(endring, na.rm = TRUE )) %>%
  ggplot(aes(gruppe, m, fill = gruppe)) +
  geom_errorbar(aes(ymin = m - s, ymax = m + s), width = 0.2) +
  geom_point(size = 4, shape = 21) +
  labs (x = "Grupper, A \u2264 29.9, B \u2265 30",
        y = " Absoulutt endring i Subkutant Fett, T2 - T4 (mean \U00B1 SD)") +
  theme(legend.position = "none") +
  theme_bw()


## regresjonsanalyse subkutant fett.

read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(fp, subkutant_fett_pre, subkutant_fett_post, gruppe, bmi) %>%
  filter(!is.na(subkutant_fett_post)) %>%
  mutate(endring = ( subkutant_fett_post- subkutant_fett_pre)) %>%
  select(fp, endring, gruppe, bmi) %>%
  ggplot(aes(x=bmi, y=endring))+
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  scale_x_continuous(name = "BMI") +
  scale_y_continuous(name = "Absoulutt endring i Subkutan fettmasse, T2 - T4")

a3 <- read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(subkutant_fett_pre, subkutant_fett_post, bmi, sex) %>%
  mutate(endring = ( subkutant_fett_post - subkutant_fett_pre)) %>%
  select(bmi, endring, sex) 


  
  m3 <- lm(endring ~ bmi, data = a3)
  
  plot(m3)
  
  summary(m3)
  
  
```


## Relativ endring Subkutant fett, MR
```{r,warning = FALSE, echo=FALSE}

lineplot.sfett <- read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(fp, bmi, subkutant_fett_pre, subkutant_fett_post, gruppe) %>%
  mutate(endring = ((subkutant_fett_post / subkutant_fett_pre)-1)*100) %>%
# mutate(absoulutt_endring = vicseralt_fett_post - vicseralt_fett_pre) %>%
  select(fp, bmi, endring, gruppe)%>%
  group_by(gruppe) %>%
  summarise(m = mean(endring, na.rm = TRUE),
            s = sd(endring, na.rm = TRUE )) %>%
ggplot(aes(gruppe, m, fill = gruppe)) +
  geom_errorbar(aes(ymin = m - s, ymax = m + s), width = 0.2) +
  geom_point(size = 4, shape = 21) +
  labs (x = "Grupper, A ≤ 29.9, B ≥ 30",
        y = " T2 - T4 (mean \U00B1 SD)") +
  theme(legend.position = "none") +

  theme_bw()

?theme
?labs

#Regresjonsanalyse subkutant fett.
  
rel.endring.s <-read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(fp, bmi, subkutant_fett_pre, subkutant_fett_post, gruppe) %>%
  filter(!is.na(subkutant_fett_post)) %>%
  mutate(endring = ((subkutant_fett_post / subkutant_fett_pre)-1)*100) %>%
  select(fp, bmi, endring, gruppe)%>%
  ggplot(aes(x=bmi, y = endring)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  scale_x_continuous(name = "KMI") +
  scale_y_continuous(name = "% Endring i Subkutant fettvev T2 - T4") 

  
a4 <- read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(subkutant_fett_pre, subkutant_fett_post, bmi, sex) %>%
  mutate(endring = ((( subkutant_fett_post/subkutant_fett_pre)-1)*100)) %>%
  select(bmi, endring, sex) %>%
  print()





  
  m4 <- lm(endring ~ bmi, data = a4)

  plot(m4)
  
  summary(m4)

  

plot_grid(rel.endring.v, lineplot.vfett, rel.endring.s, lineplot.sfett, cols = 2, rows = 2, align = "hv", rel_widths = c(10,9))

?plot_grid
?labels
?scale_y_continuous
?labs
?lims
```


## Forsøk på parra t-test Subkutant fett
```{r, include=FALSE}
read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(fp, gruppe, subkutant_fett_pre, subkutant_fett_post, bmi) %>%
  ggplot(aes(bmi, subkutant_fett_pre, color = gruppe)) + geom_boxplot()
ggplot 
```

## Absoulutt endring Total fett.

```{r, include=FALSE}
read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(fp, total_fett_pre, total_fett_post, gruppe) %>%
  mutate(endring = ( total_fett_post - total_fett_pre )) %>%
  select(endring, fp , total_fett_pre, total_fett_post, gruppe) %>%
  filter(!is.na(endring)) %>%
  group_by(gruppe) %>%
  summarise(m = mean(endring, na.rm = TRUE),
            s = sd(endring, na.rm = TRUE )) %>%
  ggplot(aes(gruppe, m, fill = gruppe)) +
  geom_errorbar(aes(ymin = m - s, ymax = m + s), width = 0.2) +
  geom_point(size = 4, shape = 21) +
  labs (x = "Grupper, A \u2264 29.9, B \u2265 30",
        y = " Absoulutt endring i Total Fett, T2 - T4 (mean \U00B1 SD)") +
  theme(legend.position = "none") +
  theme_bw()


## regresjonsanalyse subkutant fett.

read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(fp, total_fett_pre, total_fett_post, gruppe, bmi) %>%
  filter(!is.na(total_fett_post)) %>%
  mutate(endring = ( total_fett_post- total_fett_pre)) %>%
  select(fp, endring, gruppe, bmi) %>%
  ggplot(aes(x=bmi, y=endring))+
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  scale_x_continuous(name = "BMI") +
  scale_y_continuous(name = "Absoulutt endring i Total fettmasse, T2 - T4")

a5 <- read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(total_fett_pre, total_fett_post, bmi, sex) %>%
  mutate(endring = ( total_fett_post - total_fett_pre)) %>%
  select(bmi, endring, sex)



  
  m5 <- lm(endring ~ bmi, data = a5)

  plot(m5)
  
  summary(m5)
```


## Relativ endring Total fett.

```{r,}

lineplot.totfett <- read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(fp, bmi, total_fett_pre, total_fett_post, gruppe) %>%
  mutate(endring = ((total_fett_post / total_fett_pre)-1)*100) %>%
# mutate(absoulutt_endring = vicseralt_fett_post - vicseralt_fett_pre) %>%
  select(fp, bmi, endring, gruppe)%>%
  group_by(gruppe) %>%
  summarise(m = mean(endring, na.rm = TRUE),
            s = sd(endring, na.rm = TRUE )) %>%
ggplot(aes(gruppe, m, fill = gruppe)) +
  geom_errorbar(aes(ymin = m - s, ymax = m + s), width = 0.2) +
  geom_point(size = 4, shape = 21) +
  labs (x = "Grupper, A \u2264 29.9, B \u2265 30",
        y = " Prosentvis endring i Total fettmasse, T2 - T4 (mean \U00B1 SD)") +
  theme(legend.position = "none") +
  theme_bw()


#Regresjonsanalyse Total fett:

read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(fp, bmi, total_fett_pre, total_fett_post, gruppe) %>%
  filter(!is.na(total_fett_post)) %>%
  mutate(endring = ((total_fett_post / total_fett_pre)-1)*100) %>%
  select(fp, bmi, endring, gruppe)%>%
  ggplot(aes(x=bmi, y = endring)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  scale_x_continuous(name = "8 BMI") +
  scale_y_continuous(name = "Prosentvis endring i total fettvev, T2 - T4")

a5 <- read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(total_fett_pre, total_fett_post, bmi, sex) %>%
  mutate(endring = ((( total_fett_post/total_fett_pre)-1)*100)) %>%
  select(bmi, endring, sex) %>%
  print()

#m5 <- lm(endring ~ bmi, data = a5)
#plot(m5)
#summary(m5)



```




## Absoulutt endring i Total masse

```{r, include=FALSE}


## regresjonsanalyse subkutant fett.

read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(fp, total_masse_pre, total_masse_post, gruppe, bmi) %>%
  filter(!is.na(total_masse_post)) %>%
  mutate(endring = ( total_masse_post- total_masse_pre)) %>%
  select(fp, endring, gruppe, bmi) %>%
  ggplot(aes(x=bmi, y=endring))+
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  scale_x_continuous(name = "BMI") +
  scale_y_continuous(name = "Absoulutt endring i Total masse, T2 - T4")

a6 <- read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(total_masse_pre, total_masse_post, bmi, sex) %>%
  mutate(endring = ( total_masse_post - total_masse_pre)) %>%
  select(bmi, endring, sex)



  
  m6 <- lm(endring ~ bmi, data = a6)

  plot(m6)
  
  summary(m6)
```

## Relativ endring i Total masse.


```{r}

read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(fp, bmi, total_masse_pre, total_masse_post, gruppe) %>%
  filter(!is.na(total_masse_post)) %>%
  mutate(endring = ((total_masse_post / total_masse_pre)-1)*100) %>%
  select(fp, bmi, endring, gruppe)%>%
  ggplot(aes(x=bmi, y = endring)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  scale_x_continuous(name = "8 BMI") +
  scale_y_continuous(name = "Prosentvis endring i total Masse, T2 - T4")

a7 <- read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(total_masse_pre, total_masse_post, bmi, sex, hele_vev_fett) %>%
  mutate(endring = ((( total_masse_post/total_masse_pre)-1)*100)) %>%
  select(bmi, endring, sex, hele_vev_fett) %>%
  print.data.frame()

#m7 <- lm(endring ~ bmi, data = a7)
#plot(m7)
#summary(m7)

```



## Fosøk på ein sammenslått graf.

```{r}
dat1 <- read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(total_fett_pre, total_fett_post, fp, bmi) %>%
  pivot_longer( names_to = "time", 
                values_to = "pixel", 
                cols = (total_fett_pre:total_fett_post)) %>%
  mutate(time = factor(time, levels = c("total_fett_pre", "total_fett_post")))%>%
  filter(!is.na(pixel)) %>%
  ggplot(aes(time, pixel, group =fp, label = fp)) +
  geom_point() +
  geom_line()

         

dat2 <- read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(total_fett_pre, total_fett_post, fp, bmi) %>%
  mutate(gj_fett_pre = (mean(total_fett_pre))) %>%
  filter(!is.na(total_fett_post)) %>%
  filter(fp!=549) %>%
  mutate(gj_fett_post = (mean(total_fett_post))) %>%
  pivot_longer( names_to = "time1",
                values_to = "pixel2",
                cols = (gj_fett_pre:gj_fett_post)) %>%
  mutate(time1 = factor(time1, levels = c("gj_fett_pre", "gj_fett_post"))) %>%
   ggplot(aes(time1, pixel2, group =fp, label = fp)) +
  geom_point() +
  geom_line()

plot_grid(dat1,dat2, nrow = 2)


```

## Diverse

```{r, include=FALSE}

#fettvsbmi <- read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
 # select(bmi, hele_vev_fett)%>%
  #filter(!is.na(hele_vev_fett))
  
  #plot(fettvsbmi, col='blue', pch=20, cex=2, main="Forhold mellom Fettprosent og KMI",
	#xlab="KMI", ylab="Fettprosent") + 
   
# par(mfrow=c(1,1))
  


  
  


##forsøk på paret t-test, vicseralt fett.
```


   
```{r, include=FALSE}

#forsøk på cow plot
#ggplot(aes(reps, change, group = subject)) + geom line()

plot1 <- read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
 select(vicseralt_fett_pre, vicseralt_fett_post, gruppe) %>%
  
  ggplot(aes(vicseralt_fett_post, vicseralt_fett_pre, color = gruppe))
  
  plot(plot1)
  
  
  
  
 # ggplot(aes(bmi, endring,  group = fp)) + geom_line()

 # for å slå sammen flere grafer.
  
 #plot_grid (plot1, plot2,nrow=2)
  
  # bruka den til å få prosentvis endring og standaravvik.

#emmeans(kn_m1, specs = ~ "reps")
#emmeans(kn_m2, specs = ~ "reps")
#emmeans(kn_m3, specs = ~ "reps") %>%
       # data.frame() %>%
       # ggplot(aes(reps, emmean)) +
       # geom_point()
  
  
```

```{r, include=FALSE}
a <- runif(10,1,5)
b <- runif(10,1,5)
c <- runif(10,1,5)
d <- runif(10,1,5)
plot(a, b, pch=2, xlab = "a | c", ylab = "b | d")
points(c, d, col="blue")
par(mfrow=c(1,1))


```






# DXA vs Midjemål vs MR Grupert

## DXA table
```{r,warning = FALSE, echo=FALSE}


#KABLE

DXA.Android <- read_excel("TR015_DXA_Ferdig.xlsx", sheet = "Hele_fettmasse", na = "NA") %>%
  select("subject...1", bmi, t1, t2, t4) %>%
  filter(!is.na(t4),
         !is.na(t2),) %>%
  mutate(tt1 = (t1/1000),
         tt2 = (t2/1000),
         tt4 = (t4/1000))%>%
  mutate(endringt1t2 = ((tt1/tt2)-1)*100)%>%
  mutate(endringt2t4 = ((tt2/tt4)-1)*100)%>%
  pivot_longer(names_to = "Time", values_to = "values", cols = t1:endringt2t4)%>%
  group_by( Time)%>%
  summarise(m = mean(values, na.rm = TRUE), s =  sd(values, na.rm = TRUE))%>%
  mutate(ms = paste0(round(m, digits = 1)," (",round(s, digits = 1),")")) %>%
  select(Time, ms) %>%
  pivot_wider(names_from = "Time", values_from = ms) %>%
  rename(PreSup = tt1,
         Pre = tt2,
         Post = tt4,
         "% Endring PreSup-Pre" = endringt1t2,
         "% Endring Pre-Post" = endringt2t4) %>%
  select(PreSup, Pre, Post,"% Endring PreSup-Pre","% Endring Pre-Post" ) %>%
  print()

kable(DXA.Android, caption = "Endring i Total fettmasse DXA, Mean (SD)")


#Forsøk på graf ut ifa kable.

DXA.Android.G <- read_excel("TR015_DXA_Ferdig.xlsx", sheet = "Hele_fettmasse", na = "NA") %>%
  select("subject...1", bmi, t1, t2, t4) %>%
  filter(!is.na(t4),
         !is.na(t2),) %>%
  mutate(tt1 = (t1/1000),
         tt2 = (t2/1000),
         tt4 = (t4/1000))%>%
  mutate(endringt1t2 = ((tt1/tt2)-1)*100)%>%
  mutate(endringt2t4 = ((tt2/tt4)-1)*100)%>%
  pivot_longer(names_to = "Time", values_to = "values", cols = t1:endringt2t4)%>%
  group_by( Time)%>%
  summarise(m = mean(values, na.rm = TRUE), s =  sd(values, na.rm = TRUE))%>%
  mutate(ms = paste0(round(m, digits = 1)," (",round(s, digits = 1),")")) %>%
  select(Time, ms) %>%
  pivot_wider(names_from = "Time", values_from = ms) %>%
  rename(PreSup = tt1,
         Pre = tt2,
         Post = tt4,
         "% Endring PreSup-Pre" = endringt1t2,
         "% Endring Pre-Post" = endringt2t4) %>%
  select(PreSup, Pre, Post,"% Endring PreSup-Pre","% Endring Pre-Post" ) %>%
  
  ggplot(aes(Time, ms, fill = Time)) +
  geom_errorbar(aes(ymin = m - s, ymax = m + s), width = 0.2) +
  geom_point(size = 4, shape = 21) +
  labs (x = "Grupper, A ≤ 29.9, B ≥ 30", y = "T2 til T4 (mean \U00B1 SD)") +
  theme(legend.position = "none") +
 #scale_y_continuous(limits = c(-5, 20), breaks = c(-5, 0, 5, 10, 15, 20),
                    # expand = expand_scale(0)) +
  theme_bw()

plot(DXA.Android.G)

?pivot_wider

lineplot.android <- read_excel("data/TR015_DXA_Ferdig.xlsx", sheet = "Android_fettmasse", na = "NA") %>%
   select(subject,bmi,t1,t2,t3,t4, gruppe ) %>%
  filter(!is.na(gruppe)) %>%
  mutate(endring = ((t4 / t2)-1)*100) %>%
  select(subject, bmi, endring, gruppe) %>%
  group_by(gruppe) %>%
  summarise(m = mean(endring, na.rm = TRUE),
            s = sd(endring, na.rm = TRUE )) %>%
  print()
ggplot(aes(gruppe, m, fill = gruppe)) +
  geom_errorbar(aes(ymin = m - s, ymax = m + s), width = 0.2) +
  geom_point(size = 4, shape = 21) +
  labs (x = "Grupper, A ≤ 29.9, B ≥ 30", y = "T2 til T4 (mean \U00B1 SD)") +
  theme(legend.position = "none") +
 #scale_y_continuous(limits = c(-5, 20), breaks = c(-5, 0, 5, 10, 15, 20),
                    # expand = expand_scale(0)) +
  theme_bw()

plot(lineplot.android)


```


## Midjemål table


```{r,warning = FALSE, echo=FALSE}

Midjemål <- read_excel("data/Midje og blodtrykkk.xlsx") %>%
  select(subject, bmi, waist_1, waist_2, waist_4) %>%
  filter(!is.na(waist_4))%>%
  mutate(endringw1w2 = ((waist_1/waist_2)-1)*100)%>%
  mutate(endringw2w4 = ((waist_2/waist_4)-1)*100)%>%
  select(waist_1, waist_2, waist_4, endringw1w2, endringw2w4) %>%
  pivot_longer(names_to = "Time1",  values_to = "Values1", cols = waist_1:endringw2w4)%>%
  group_by(Time1) %>%
  summarise(m = mean(Values1, na.rm = TRUE), s = sd(Values1, na.rm = TRUE))%>%
   mutate(ms = paste0(round(m, digits = 1)," (",round(s, digits = 1),")")) %>%
  select(Time1, ms) %>%
  pivot_wider(names_from = "Time1", values_from = ms) %>%
  select(waist_1, waist_2, waist_4, endringw1w2, endringw2w4)%>%
  rename(PreSup = waist_1,
         Pre = waist_2,
         Post = waist_4,
         "% Endring PreSup-Pre" = endringw1w2,
         "% Endring Pre-Post" = endringw2w4) %>%
  print()


 
  
kable(Midjemål, caption = "Endring i Midjemål, Mean (SD)")


```


## MR table

```{r,warning = FALSE, echo=FALSE}

MR.table.change <- read_excel("data/MR_Bilder_rådata.xlsx", sheet = "Ark3", na = "Na") %>%
  select(fp, bmi, total_masse_pre, total_masse_post) %>%
  filter(!is.na(total_masse_post))%>%
  mutate(endring = ((total_masse_post / total_masse_pre)-1)*100) %>%
  select(total_masse_pre, total_masse_post, endring)%>%
  pivot_longer(names_to = "Time2",  values_to = "Values2", cols = total_masse_pre:endring)%>%
  group_by(Time2) %>%
  summarise(m = mean(Values2, na.rm = TRUE), s = sd(Values2, na.rm = TRUE))%>%
   mutate(ms = paste0(round(m)," (",round(s),")")) %>%
  select(Time2, ms) %>%
  pivot_wider(names_from = "Time2", values_from = ms) %>%
  rename(Pre = total_masse_pre,
         Post = total_masse_post,
         "%Endring Pre-Post" = endring) %>%
  select(Pre, Post, "%Endring Pre-Post")%>%
  print()


kable(MR.table.change)
```

## Inermuskulærf fett table.

```{r, include=FALSE}
even <- read_excel("data/TR015_MR_miri_HH-2-2.xlsx", sheet = "Ark4", na = "NA")%>%
  select(subject,prosent_fett)

IR.table.change <- read_excel("data/TR015_MR_miri_HH-2-2.xlsx", sheet = "Ark4", na = "NA")%>%
  select(subject,leg, timepoint, intra_fett) %>%
  pivot_wider(names_from = "timepoint", values_from = "intra_fett" ) %>%
  mutate(endring = (((t4 / t2)-1)*100)) %>%
  filter(!is.na(endring))%>%
  select(t2, t4, endring) %>%
  pivot_longer(names_to = "Time3",  values_to = "Values3", cols = t2:endring)%>%
  group_by(Time3) %>%
  summarise(m = mean(Values3, na.rm = TRUE), s = sd(Values3, na.rm = TRUE))%>%
   mutate(ms = paste0(round(m)," (",round(s),")")) %>%
  select(Time3, ms) %>%
  pivot_wider(names_from = "Time3", values_from = ms) %>%
  rename(Pre = t2,
         Post = t4,
         "%Endring Pre-Post" = endring) %>%
  select(Pre, Post, "%Endring Pre-Post") %>%
  print()
  
```


## Tables Midjemål, DXA, MR
```{r, warning=FALSE, echo=FALSE}

kable(Midjemål, caption = "**Endring i Midjemål**")
kable(DXA.Android, caption = "**Endring i Total fettmasse DXA**")
kable(MR.table.change, caption = "**Endring i Total fettmasse MR**")
kable(IR.table.change, caption = "**Endring i Intermuskulær fettmasse MR**")


# korleis kan eg endre A -> A ≤ 29.9, samma meg gruppe B?
#rownames(MR.table.change)[rownames(MR.table.change) == "A"] = "A≤29.9"
#mutate(Gruppe = factor(Gruppe, levels = c("A≤29,9", "B≥30"))) #-blir NA

#korleis kan eg line alle tabels opp etter kvarandre oversiktelig?
?kable
?knitr::kable
?kables
#row.names	->Logical: whether to include row names. By default, row names are included if rownames(x) is neither NULL nor identical to 1:nrow(x).
?renam


```



# Graf på fettprosent
## hele fettmasse
## visceralt fett (android)
```{r}

and.fett.prosent <- read_excel("data/TR015_DXA_Ferdig.xlsx", 
    sheet = "Android_fettmasse") %>%
  select(subject, prosent_fett, t1, t2, t3, t4, gruppe) %>%
  filter(!is.na(t4))%>%
  mutate(endring = (t4-t2)) %>%
  select(subject, prosent_fett, endring, gruppe) %>%
  ggplot(aes(x = prosent_fett, y = endring)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  scale_x_continuous(name = " Fettprosent") +
  scale_y_continuous(name = "Endring i android fettmasse T2-T4" )

plot(and.fett.prosent)
```

##visceralt fett (MR)



## intramuskulært fett.


###

```{r}
and.fett.prosent <- read_excel("data/TR015_DXA_Ferdig.xlsx", 
    sheet = "Android_fettmasse") %>%
  select(subject, prosent_fett, t1, t2, t3, t4, gruppe) %>%
  filter(!is.na(t4))%>%
  mutate(endring = (t4-t2)) %>%
  select(subject, prosent_fett, endring, gruppe) %>%
  ggplot(aes(x = prosent_fett, y = endring)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  scale_x_continuous(name = " Fettprosent") +
  scale_y_continuous(name = "Endring i android fettmasse T2-T4" )

plot(and.fett.prosent)

  



```


# irwfjgrg

```{r, include=FALSE}
bbb <- read_excel("TR015_DXA_Ferdig.xlsx", sheet = "Hele_fettmasse", na = "NA") %>%
  select("subject...1", bmi, gruppe, t1, t2, t4) %>%
  filter(!is.na(t4), 
         !is.na(gruppe),
         !is.na(t2),) %>%
  mutate(endringt1t2 = ((t1/t2)-1)*100)%>%
  mutate(endringt2t4 = ((t2/t4)-1)*100)%>%
  pivot_longer(names_to = "Time", values_to = "values", cols = t1:endringt2t4)%>%
  group_by(gruppe, Time)%>%
  summarise(m = mean(values, na.rm = TRUE), s =  sd(values, na.rm = TRUE))%>%
  mutate(ms = paste0(round(m)," (",round(s),")")) %>%
  select(gruppe, Time, ms) %>%
  pivot_wider(names_from = "Time", values_from = ms) %>%
  rename(PreSup = t1,
         Pre = t2,
         Post = t4,
         Gruppe = gruppe,
         "% Endring PreSup-Pre" = endringt1t2,
         "% Endring Pre-Post" = endringt2t4) %>%
  select(Gruppe, PreSup, Pre, Post,"% Endring PreSup-Pre","% Endring Pre-Post" )

kable(bbb, caption = "Endring i Total fettmasse DXA, Mean (SD)")



aaa<- read_excel("TR015_DXA_Ferdig.xlsx", sheet = "Hele_fettmasse", na = "NA") %>%
  print()




hele.fett.prosent1 <- read_excel("data/TR015_DXA_Ferdig.xlsx", sheet = "Hele_fettmasse") %>%
  select("subject...1",gruppe, prosent_fett, t1, t2, t3, t4) %>%
  filter(!is.na(t4), 
         !is.na(gruppe),
         !is.na(t2),) %>%
  mutate(endringt1t2 = ((t2/t1)-1)*100)%>%
  mutate(endringt2t4 = ((t4/t2)-1)*100)%>%
   pivot_longer(names_to = "Time", values_to = "values", cols = t1:endringt2t4)%>%
  group_by(gruppe, Time)%>%
  summarise(m = mean(values, na.rm = TRUE), s =  sd(values, na.rm = TRUE))%>%
  mutate(ms = paste0(round(m)," (",round(s),")")) %>%
  group_by(Time)%>%
  pivot_wider(names_from = "Time", values_from = "ms")%>%
  print()
  
  #select("subject...1", prosent_fett, endring, gruppe) %>%
  #ggplot(aes(x = prosent_fett, y = endring)) +
  #geom_point() +
  #geom_smooth(method = "lm", se = TRUE) +
  #scale_x_continuous(name = " Fettprosent") +
  #scale_y_continuous(name = "Fettmasse (% endring) " )

```





